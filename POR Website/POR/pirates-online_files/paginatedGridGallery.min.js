define("paginatedGridGallery",["lodash","react","santaProps","core","utils","imageClientApi","galleriesCommon","image"],function(a,b,c,d,e,f,g,h){"use strict";function p(a,b,c,d,e,f){var g=l.getItemWidth(a.margin,a.numCols,b,m.getSkinWidthDiff(e)),h=l.getItemHeight(a.margin,c,d,m.getSkinHeightDiff(e)),i=b-m.getSkinWidthDiff(e)+a.margin,j=c-m.getSkinHeightDiff(e)+a.margin;return{width:"Shrink"===f?g:i,height:"Shrink"===f?h:j}}function q(a,b){return{visibility:"visible",position:"absolute",cursor:"pointer",padding:0,left:parseInt(a.props.style.left,10)+m.getSkinWidthDiff(b)/2,top:parseInt(a.props.style.top,10),width:parseInt(a.props.containerWidth,10),height:parseInt(a.props.containerHeight,10)}}function r(b,c){var d=Math.max(b.length,c.length),e="emptyDivToFillMatrix";a.times(d,function(a){b[a]||(b[a]=e),c[a]||(c[a]=e)})}function s(a,b){var c=b;return c||(c=a===!0?"zoomMode":"disabled"),c}function t(c){var d=a.defaults({href:c.href||"#",style:a.assign({height:"100%",display:"block",width:"100%",position:"absolute",top:"0px",left:"0px",backgroundColor:"#ffffff",filter:"alpha(opacity=0)",opacity:"0",cursor:c.cursor},e.style.prefix({userSelect:"none",userDrag:"none",userModify:"read-only"}))},c);return c.href||(d.onClick=function(a){a.preventDefault(),a.stopPropagation()}),b.DOM.a(d)}function u(b,c,d,e,f,g,h){var m,i={},j="Go to link",k="pointer",l=s(c.expandEnabled,c.galleryImageOnClickAction);return b.link&&(m=e(g)),c.goToLinkText&&(j=c.goToLinkText),"zoomMode"===l?i=f(d,b,h):m&&"goToLink"===l?i=m:k="default",a.assign(i,{linkData:m,goToLinkText:j,cursor:k,clickAction:l}),i}function v(a){return a?a.title:""}function w(a){return a?a.description:""}var i={numCols:3,maxRows:3,margin:0,transition:"seq_crossFade_All",transDuration:1,autoplayInterval:3,autoplay:!1,showAutoplay:!0,showNavigation:!0,showCounter:!0},j=d.compMixins,k=d.componentUtils,l=g.utils.matrixCalculations,m=g.utils.galleriesHelperFunctions,n=k.galleryPagingCalculations,o=k.matrixAnimationManipulation;return{displayName:"PaginatedGridGallery",mixins:[j.skinBasedComp,g.mixins.galleryAutoPlayMixin,j.animationsMixin,j.timeoutsMixin,j.compStateMixin],propTypes:a.assign({compProp:c.Types.Component.compProp.isRequired,compData:c.Types.Component.compData.isRequired,id:c.Types.Component.id.isRequired,skin:c.Types.Component.skin.isRequired,style:c.Types.Component.style.isRequired,renderLink:c.Types.Link.renderLink.isRequired,renderImageZoomLink:c.Types.Link.renderImageZoomLink.isRequired,isZoomOpened:c.Types.isZoomOpened.isRequired,windowTouchEventsAspect:c.Types.SiteAspects.windowTouchEvents.isRequired,isMobileView:c.Types.isMobileView,isMobileDevice:c.Types.Device.isMobileDevice,isTabletDevice:c.Types.Device.isTabletDevice,isPlayingAllowed:c.Types.RenderFlags.isPlayingAllowed,onAnimationCompleteCallback:b.PropTypes.func,createGalleryItem:b.PropTypes.func,getItemRef:b.PropTypes.func},c.santaTypesUtils.getSantaTypesByDefinition(h)),statics:{useSantaTypes:!0,behaviors:{nextSlide:{methodName:"next"},prevSlide:{methodName:"prev"}},publicState:["currentIndex"]},getInitialState:function(){return this.props.windowTouchEventsAspect.registerToWindowTouchEvent("touchStart",this),this.isAnimating=!1,{hoveredImage:null,currentIndex:0,$itemSelection:"idle",$mobile:this.props.isMobileDevice||this.props.isTabletDevice?"mobile":"notMobile",$displayDevice:this.props.isMobileView?"mobileView":"desktopView",$animationInProcess:null,$touchRollOverSupport:"touchRollOut"}},componentWillReceiveProps:function(a){var b=!1,c={$mobile:a.isMobileDevice||a.isTabletDevice?"mobile":"notMobile",$displayDevice:a.isMobileView?"mobileView":"desktopView"};if(this.props.compProp.autoplay!==a.compProp.autoplay){var d=a.compProp.autoplay&&!this.props.isZoomOpened&&this.props.isPlayingAllowed?"autoplayOn":"autoplayOff";b=!0,c.shouldAutoPlay=a.compProp.autoplay,c.$slideshow=d}this.setState(c,function(){b&&(this.updateAutoplayState(),this.handleAction(c.$slideshow))}.bind(this))},componentDidMount:function(){this.updateAutoplayState()},componentWillUnmount:function(){this.props.windowTouchEventsAspect.unregisterFromWindowTouchEvent("touchStart",this)},getButtonVisibility:function(a,b){return this.props.compProp.showNavigation===!1||this.state.currentIndex===a&&this.state.currentIndex===b||this.props.compProp.isHidden?"hidden":"visible"},getSkinProperties:function(){var b=a.defaults(this.props.compProp,i),c=this.props.compData,d=n.getPageItems(c.items,this.state.currentIndex,b.numCols,b.maxRows),e=this.state.hoveredImage?this.state.hoveredImage.props.compData:null,f=this.state.hoveredImage?u(e,b,this.props.rootNavigationInfo,this.props.renderLink,this.props.renderImageZoomLink,e.link,c.id):{},g=n.getNextPageItemIndex(this.state.currentIndex,b.numCols,b.maxRows,c.items.length),h=n.getPrevPageItemIndex(this.state.currentIndex,b.numCols,b.maxRows,c.items.length),j=n.getPageItems(c.items,g,b.numCols,b.maxRows),k=n.getPageItems(c.items,h,b.numCols,b.maxRows),l=this.getButtonVisibility(g,h),o=!this.props.compProp.isHidden&&this.props.compProp.showCounter&&d.length>0?"visible":"hidden",p=this.classSet({"show-counter":"hidden"!==l||"hidden"!==o});return{"":{"data-height-diff":m.getSkinHeightDiff(this.props.skin),"data-width-diff":m.getSkinWidthDiff(this.props.skin),onMouseLeave:function(a,b){this.onRollOut(a,b,!0)}.bind(this),style:{overflow:"hidden"}},itemsContainer:{children:this.createDisplayedItems(d,j,k,g,h),"data-gallery-id":this.props.id,className:p,style:{position:"relative",overflow:"hidden",width:this.props.style.width-m.getSkinWidthDiff(this.props.skin),height:this.props.style.height-m.getSkinHeightDiff(this.props.skin)}},buttonPrev:{onClick:function(a){a&&a.stopPropagation(),this.prev()}.bind(this),"data-gallery-id":this.props.id,style:{visibility:l}},buttonNext:{onClick:function(a){a&&a.stopPropagation(),this.next()}.bind(this),"data-gallery-id":this.props.id,style:{visibility:l}},counter:{children:n.getCounterText(this.state.currentIndex,b.numCols,b.maxRows,c.items.length),style:{visibility:o},"data-gallery-id":this.props.id},autoplay:{onClick:this.toggleAutoPlay,"data-gallery-id":this.props.id,style:{cursor:"pointer",visibility:this.shouldShowAutoPlay()?"visible":"hidden"}},rolloverHolder:{style:this.state.hoveredImage?q(this.state.hoveredImage,this.props.skin):{visibility:"hidden",cursor:"pointer"},"data-gallery-id":this.props.id,addChildBefore:[t(f),"link"]},title:{children:this.state.hoveredImage?v(e):"","data-gallery-id":this.props.id},description:{children:this.state.hoveredImage?w(e):"","data-gallery-id":this.props.id},link:a.merge(f.linkData,{children:f.goToLinkText,"data-gallery-id":this.props.id,refInParent:"link",style:{display:"goToLink"!==f.clickAction&&f.linkData?"block":"none"}}),textWrapper:{"data-gallery-id":this.props.id}}},onMouseEnter:function(a){var b=this.refs[a];this.state.hoveredImage!==b&&this.setState({hoveredImage:b,$itemSelection:"rollover"})},onRollOut:function(a,b,c){("IMG"!==a.target.tagName||c)&&this.setState({hoveredImage:null,$itemSelection:"idle"})},onComponentTouchStart:function(a){this.onMouseEnter(a),"touchRollOut"===this.state.$touchRollOverSupport&&this.setState({$touchRollOverSupport:"touchRollOver"})},onWindowTouchStart:function(a){var b=a.target.getAttribute("data-gallery-id")||a.target.parentNode.getAttribute("data-gallery-id");"touchRollOver"===this.state.$touchRollOverSupport&&b!==this.props.id&&(this.onRollOut({target:""},null,!0),this.setState({$touchRollOverSupport:"touchRollOut"}))},next:function(a){this.movePage(!1,a)},prev:function(a){this.movePage(!0,a)},movePage:function(a,b){var c=this.props.compProp,d=this.props.compData,e=a?n.getPrevPageItemIndex(this.state.currentIndex,c.numCols,c.maxRows,d.items.length):n.getNextPageItemIndex(this.state.currentIndex,c.numCols,c.maxRows,d.items.length);if(this.isAnimating||e===this.state.currentIndex)return this._movePageQueue||(this._movePageQueue=[]),void this._movePageQueue.push(a);var f=n.getPageItems(d.items,e,c.numCols,c.maxRows),g=n.getPageItems(d.items,this.state.currentIndex,c.numCols,c.maxRows),h=this.convertDataItemsToRefs(g,this.state.currentIndex),i=this.convertDataItemsToRefs(f,e);f&&(this.setState({$animationInProcess:"animationInProcess",$itemSelection:"idle"}),this.performAnimation(h,i,a,e,b))},performAnimation:function(b,c,d,e,f){var g=this.props.compProp,h=l.getAvailableRowsNumber(g.maxRows,g.numCols,this.props.compData.items.length),i=o.getSortedArrayAndStagger(g.transition,b,c,h,g.numCols,this.timingFunctionIndex||0),j=i.transName,k=this.props.style.height,m=p(g,this.props.style.width,k,h,this.props.skin,j);this.timingFunctionIndex=i.timingFunctionIndex+1;var n="none"===g.transition?0:g.transDuration,q=i.stagger,s=this.sequence(),t=i.sporadicallyRandom&&i.sourceNodesArrSorted.length>1;i.sourceNodesArrSorted.length!==i.destNodesArrSorted.length&&r(i.sourceNodesArrSorted,i.destNodesArrSorted),a.forEach(i.sourceNodesArrSorted,function(a,b){var c=i.destNodesArrSorted[b],e={width:m.width,height:m.height,reverse:t?Math.random()>.5:!!d},f=q;"Shrink"!==j&&"CrossFade"!==j||(e.stagger=q,f=0),s.add({sourceRefs:a,destRefs:c},j,n,0,e,b*f)}),s.onStartAll(function(){this.isAnimating=!0}.bind(this)).onCompleteAll(function(){this.animationCompleteCallback(e,f)}.bind(this)).execute()},animationCompleteCallback:function(b,c){this.isAnimating=!1,this.props.onAnimationCompleteCallback&&this.props.onAnimationCompleteCallback(),this.setState({currentIndex:b,$animationInProcess:null},function(){this.updateAutoplayState(),a.isFunction(c)&&c()}.bind(this)),this._movePageQueue&&this._movePageQueue.length>0&&setTimeout(function(){this.movePage(this._movePageQueue.shift())}.bind(this),100)},createDisplayedItems:function(b,c,d,e,f){var g=this.props.compProp,h=this.props.compData,i=l.getItemWidth(g.margin,g.numCols,this.props.style.width,m.getSkinWidthDiff(this.props.skin)),j=l.getAvailableRowsNumber(g.maxRows,g.numCols,h.items.length),k=l.getItemHeight(g.margin,this.props.style.height,j,m.getSkinHeightDiff(this.props.skin)),n=[],o=[],p=a.map(b,function(a,c){return this.createGalleryItem(a,c,i,k,this.state.currentIndex,b.length,"curr")},this);return e!==this.state.currentIndex&&(n=a.map(c,function(a,b){return this.createGalleryItem(a,b,i,k,e,c.length,"next",{visibility:"hidden"})},this)),f!==e&&f!==this.state.currentIndex&&(o=a.map(d,function(a,b){return this.createGalleryItem(a,b,i,k,f,d.length,"prev",{visibility:"hidden"})},this)),n.concat(o).concat(p)},createGalleryItem:function(a,b,c,d,e,f,g,h){return this.props.createGalleryItem?this.props.createGalleryItem(this.props.id,a,b,e,f,h,this.classSet):this.createImageItem(a,b,c,d,e,g,h)},convertDataItemsToRefs:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.props.getItemRef?this.props.getItemRef(this.props.id,b,d):this.getImageItemRef(b,d);c.push(e)}return c},getImageItemRef:function(a,b){return this.props.id+a+b},getImageItemKey:function(a,b){return this.state.currentIndex+this.props.id+a+"#"+b},createImageItem:function(b,c,d,e,g,h,i){var j=l.getItemPosition(c,d,e,this.props.compProp.margin,this.props.compProp.numCols),k=l.getImageStyle(e,d,b.height,b.width);return this.createChildComponent(b,"core.components.Image","img",{id:this.getImageItemRef(g,c),ref:this.getImageItemRef(g,c),key:this.getImageItemKey(g,c),imageData:b,containerWidth:Math.round(d),containerHeight:Math.round(e),displayMode:f.fittingTypes.SCALE_TO_FILL,usePreloader:!0,imgStyle:k,"data-gallery-id":this.props.id,"data-page-desc":h,"data-query":b.id,"data-image-index":g+c,onMouseEnter:this.onMouseEnter.bind(this,this.getImageItemRef(g,c)),onTouchStart:this.onComponentTouchStart.bind(this,this.getImageItemRef(g,c)),style:a.merge({left:j.left,top:j.top,position:"absolute",overflow:"hidden",transform:"none",clip:"auto"},i)})}}});